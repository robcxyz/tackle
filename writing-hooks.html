<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating Hooks &mdash; tackle-box 0.2.0-alpha.6 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> tackle-box
          </a>
              <div class="version">
                0.2.0-alpha.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Creating Hooks</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#basic-example">Basic Example</a></li>
<li><a class="reference internal" href="#concepts">Concepts</a><ul>
<li><a class="reference internal" href="#pydantic-and-types-fields">Pydantic and Types / Fields</a></li>
<li><a class="reference internal" href="#arguments">Arguments</a><ul>
<li><a class="reference internal" href="#arguments-with-list-and-dict-types">Arguments with list and dict types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controlling-rendering-of-fields">Controlling Rendering of Fields</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">tackle-box</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Creating Hooks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/writing-hooks.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-hooks">
<h1>Creating Hooks<a class="headerlink" href="#creating-hooks" title="Permalink to this headline"></a></h1>
<p>This document covers all aspects of writing hooks focusing on the API and it’s semantics for how it can be used within tackle files. For creating providers and creating dependencies, please check out the <a class="reference internal" href="creating-providers.html"><span class="doc">creating providers</span></a> section.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Tackle box hooks are any object located within the <code class="docutils literal notranslate"><span class="pre">hooks</span></code> directory that extends a BaseHook object and implement an <code class="docutils literal notranslate"><span class="pre">execute</span></code> method as the entrypoint to calling the hook. BaseHook objects are <a class="reference external" href="https://github.com/samuelcolvin/pydantic">pydantic</a> objects as well such that their attributes need to include type annotations. All of these attributes are then made accessible when calling the hook from a yaml file.</p>
<p>There are couple other semantics that will be described in this document such as mapping arguments, excluding from rendering, and auto-generating documentation for your hooks that will be covered later in this document.</p>
</section>
<section id="basic-example">
<h2>Basic Example<a class="headerlink" href="#basic-example" title="Permalink to this headline"></a></h2>
<p>The easiest way to understand this is through a simple example.</p>
<p>If we had a file structure like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── hooks
   └── do_stuff.py  # Name of file doesn&#39;t matter
└── tackle.yaml  # Not needed
</pre></div>
</div>
<p>We could have a file <code class="docutils literal notranslate"><span class="pre">do_stuff.py</span></code> that has an object <code class="docutils literal notranslate"><span class="pre">DoStuffHook</span></code> that extends the <code class="docutils literal notranslate"><span class="pre">BaseHook</span></code> and implements an <code class="docutils literal notranslate"><span class="pre">execute</span></code> method which in this case both prints and returns the <code class="docutils literal notranslate"><span class="pre">things</span></code> attribute. Additionally there is a private <code class="docutils literal notranslate"><span class="pre">_args</span></code> attribute which can be used to map positional arguments to an attribute, in this case <code class="docutils literal notranslate"><span class="pre">things</span></code> (more on this later).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tackle</span> <span class="kn">import</span> <span class="n">BaseHook</span><span class="p">,</span> <span class="n">Field</span>

<span class="k">class</span> <span class="nc">DoStuffHook</span><span class="p">(</span><span class="n">BaseHook</span><span class="p">):</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;do-stuff&quot;</span>
    <span class="n">things</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;All the things.&quot;</span><span class="p">)</span>
    <span class="n">_args</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;things&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">things</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">things</span>
</pre></div>
</div>
<p>One could then run a tackle file that looks like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">compact-expression-&gt;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">do-stuff All the things</span><span class="w"></span>
<span class="nt">expanded-expression</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">-&gt;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">do-stuff</span><span class="w"></span>
<span class="w">  </span><span class="nt">things</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">All the things</span><span class="w"></span>
</pre></div>
</div>
<p>Which when run would print out “All the things” twice and return the following context.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">compact-expression</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">All the things</span><span class="w"></span>
<span class="nt">expanded-expression</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">All the things</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline"></a></h2>
<section id="pydantic-and-types-fields">
<h3>Pydantic and Types / Fields<a class="headerlink" href="#pydantic-and-types-fields" title="Permalink to this headline"></a></h3>
<p>Pydantic has some idioms to be aware of when writing hooks specifically around types and fields. Every attribute needs to be declared with a type in pydantic and will throw an error if the type is not explicitly declared within the attribute’s definition or if the wrong type is fed into the field. Because everything that is output from a hook needs to serializable (i.e. it can’t return python objects), many <a class="reference external" href="https://pydantic-docs.helpmanual.io/usage/types/">pydantic types</a> aren’t usable unless they can be directly serialized back into a structured data format (i.e. a string, int, float, list, or dict).</p>
<p>Multiple types for attributes are allowed by use of the <code class="docutils literal notranslate"><span class="pre">Union</span></code> or <code class="docutils literal notranslate"><span class="pre">Optional</span></code> types (<a class="reference external" href="https://stackoverflow.com/a/51710151/15781389">see difference</a>) so that within the execute statement one can qualify the type and process it appropriately. For instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tackle</span> <span class="kn">import</span> <span class="n">BaseHook</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="k">class</span> <span class="nc">DoStuffHook</span><span class="p">(</span><span class="n">BaseHook</span><span class="p">):</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;do-stuff&quot;</span>
    <span class="n">things</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_args</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;things&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">things</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">things</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thing = </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">things</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">things</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">things</span>
</pre></div>
</div>
<hr class="docutils" />
<ul class="simple">
<li><p>[ ] TODO</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="arguments">
<h3>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline"></a></h3>
<p>As you may have noticed, tackle-box supports two general types of hook calls, compact and expanded. The only way compact expressions are able to take arguments is through mapping those arguments to fields within hooks.  This is done by making an <code class="docutils literal notranslate"><span class="pre">_args</span></code> private attribute which is a list of strings pointing to the attributes the indexed arguments relate to.  For instance from our example before:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DoStuffHook</span><span class="p">(</span><span class="n">BaseHook</span><span class="p">):</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;do-stuff&quot;</span>
    <span class="n">things</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">more_things</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_args</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;things&#39;</span><span class="p">,</span> <span class="s1">&#39;more_things&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Now we are adding a field <code class="docutils literal notranslate"><span class="pre">more_things</span></code> which is another string that one could call like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">compact-expression-&gt;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">do-stuff All the things</span><span class="w"></span>
</pre></div>
</div>
<p>Would be the equivalent of:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">expanded-expression</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">-&gt;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">do-stuff</span><span class="w"></span>
<span class="w">  </span><span class="nt">things</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">All</span><span class="w"></span>
<span class="w">  </span><span class="nt">more_things</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">the things</span><span class="w"></span>
</pre></div>
</div>
<p>This is because the first argument “All” after the hook type “do-stuff” is not encapsulated with quotes and so arguments after it are grouped together. If we wanted to call it with two distinct attributes, we’d need to put quotes around them like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">compact-expression-&gt;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">do-stuff &quot;All the things&quot; &quot;with other stuff&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>Would be the equivalent of:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">expanded-expression</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">-&gt;</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">do-stuff</span><span class="w"></span>
<span class="w">  </span><span class="nt">things</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">All the things</span><span class="w"></span>
<span class="w">  </span><span class="nt">more_things</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">with other stuff</span><span class="w"></span>
</pre></div>
</div>
<section id="arguments-with-list-and-dict-types">
<h4>Arguments with list and dict types<a class="headerlink" href="#arguments-with-list-and-dict-types" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p>[ ] TODO</p></li>
</ul>
</section>
</section>
<section id="controlling-rendering-of-fields">
<h3>Controlling Rendering of Fields<a class="headerlink" href="#controlling-rendering-of-fields" title="Permalink to this headline"></a></h3>
<blockquote>
<div><p>As of the time of this writing, <code class="docutils literal notranslate"><span class="pre">validator</span></code> objects are not supported but hopefully will be in the future</p>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Rob Cannon.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>