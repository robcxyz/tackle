# Providers

This document covers all aspects of creating providers including the semantics of the file structure and dependencies.  For writing hooks which are contained within providers, check out the writing hooks documents for [python](python-hooks.md) and [declarative](declarative-hooks.md) hooks.

As a recap, `providers` are collections of hooks and / or tackle files that call additional hooks. They can be stored remotely in a git repository and then ran / imported from tackle files or called directly from the [command line](command-line.md).  For more information about tackle box's structure, check out the [project structure](project-structure.md) docs.

## Quick Start

Since tackle box is a code generator, it makes sense for it to be able to generate the boilerplate to create providers. The quickest way to do that is with the `tackle-provider` provider which can be run as:

```shell
tackle robcxyz/tackle-provider
```

The provider will then go through a number of configuration options such as:

- What type of license (ie Apache vs MIT vs closed source)
- Types of tests (unittest vs pytest)
- Intention of the provider (code generator vs utility)

Using this provider one can create a functional provider in minutes that when pushed to github can be called with `tackle <your org>/<your repo>`.

## Remote Providers

Tackle ships with numerous native providers but additional ones can be accessed when they are committed to a git repository like on github. By default, tackle uses the **latest versioned release** of a provider but to use the latest commit, one can add the `--latest` flag to override this default. Additionally a specific release can be used by specifying the `--checkout` flag.  

- `tackle gh-org/repo`
    - If there is a release, use that
    - Otherwise use latest commit
- `tackle gh-org/repo --latest`
    - Use the latest commit regardless of release
- `tackle gh-org/repo --checkout v0.1.0`
    - Use a specific release

## Configuration Options

### Requirements

Each provider can have it's own requirements which when the provider is imported / called are automatically installed to support the execution of hooks. Requirements are located at the base of the provider as in the following directory structure:

```
├── hooks
│ └── hooks.py
│ └── requirements.txt
└── tackle.yaml
```

### Lazy Imports

It's possible for a hook to have dependencies yet not automatically install the requirements until the hook is actually used.  This manifests itself within the core providers where you have many hooks that have additional dependencies yet are only installed when the hook is actually used.  These lazy imports require additional configuration though through the use of an `__init__.py` file like in this directory structure:

```
├── hooks
│ └── __init__.py
│ └── hooks.py
│ └── requirements.txt
└── tackle.yaml
```

Within the `__init__.py`, you need to have the following content to declare the hook types:

```python
hook_types = ["git_clone"]
```

This way the interpretter doesn't need to actually import the hook but still is aware of the `hook_type` so that when it is called, it knows where to find the appropriate code to install the `requirements.txt` and run the hook.

### Autogenerated Docs

Docs are automatically generated for any hooks located within the native providers directory. The docs are generated by a [tackle file](docs-gen.yaml) located in the `/docs` directory in the source and uses the [provider_docs](providers/Tackle/provider_docs.md) hook to extract metadata about each hook and render a set of [templates](https://github.com/robcxyz/tackle-box/tree/main/docs/templates). Additional metadata for each provider is located in a `.tackle.meta.yaml` file per the following directory structure.

```
├── hooks
│ └── hooks.py
└── .tackle.meta.yaml
```

The `.tackle.meta.yaml` is itself a tackle file so can contain hooks that can read other files (ie test fixtures or fields within the same file). The structure is:

```yaml
name: Name of hook (Required)

description: Description of hook (Required)

examples: # Optional
  - name: "[hook_type](hook_type.md)"
    description: Description of hook
    content: |
      # A yaml string as input example
      stuff: things
      a key->: hook_type stuff
    output: |
      stuff: things
      a key: things

hook_examples:
  hook_type:  # Key must match hook_type
    - description: Description of hook
    content: |
      # A yaml string as input example
      stuff: things
      a key->: hook_type stuff
    output: |
      stuff: things
      a key: things
```

See [examples in source](https://github.com/robcxyz/tackle-box/blob/main/tackle/providers/collections/.tackle.meta.yaml) for further information.
